# Cross-manifest and component-based validation rule specification 
# `attribute` = attribute rule applies to
# `manifest` = the designated component manifest that the rule is used for
# not to be confused with the target manifest or target attribute, 
# which is in the format TargetManifest.TargetAttribute in the rule text
# `level` = whether to raise a warning or an error
# `rules` = list of validation rules to be combined per component

---
attributes: 

  - attribute: individualID

    rules_applied_to_manifests:

      - manifest: IndividualHumanMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne IndividualKey.individualID set
          - unique
          - required

      - manifest: IndividualAnimalMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne IndividualKey.individualID set
          - unique
          - required

      - manifest: IndividualAnimalMODEL-ADMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne IndividualKey.individualID set
          - unique
          - required

      - manifest: FileAnnotationManifest
        level: error
        rules: 
          - matchExactlyOne IndividualKey.individualID value

      - manifest: BiospecimenMetadataTemplate
        level: error
        rules:
          - matchExactlyOne IndividualKey.individualID value
          - required

      - manifest: BiospecimenInvitroMetadataTemplate
        level: error
        rules:
          - matchExactlyOne IndividualKey.individualID value
          - required

      - manifest: AssayMRIMetadataTemplate
        level: error
        rules:
          - matchExactlyOne IndividualKey.individualID value
          - required

      - manifest: AssayPETMetadataTemplate
        level: error
        rules:
          - matchExactlyOne IndividualKey.individualID value
          - required

      - manifest: AssayAutoradMetadataTemplate
        level: error
        rules: 
        - matchExactlyOne IndividualKey.individualID value
        - required

      - manifest: IndividualKey
        level: error
        rules:
          - matchNone IndividualKey.individualID value
          - required
          - unique
          - regex match ^[a-zA-Z0-9_-]+$

  - attribute: specimenID

    rules_applied_to_manifests:

      - manifest: BiospecimenMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required
          - unique

      - manifest: BiospecimenInvitroMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required
          - unique

      - manifest: BiospecimenMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required
          - unique

      - manifest: FileAnnotationManifest
        level: error
        rules:
          - matchExactlyOne SpecimenKey.specimenID value
      
      - manifest: Assay16SrRNAseqMetadataTemplate
        level: error
        rules:
          - matchExactlyOne SpecimenKey.specimenID value
          - required
      
      - manifest: AssayATACSeqMetadataTemplate
        level: error
        rules: 
        - matchExactlyOne SpecimenKey.specimenID value
        - required
      
      - manifest: AssayBisulfiteSeqMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required
      
      - manifest: AssayChIPSeqMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required
      
      - manifest: AssayHICMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required

      - manifest: AssayMetabolomicsMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required

      - manifest: AssayMethylationArrayMetadataTemplate
        level: error
        rules:
          - matchExactlyOne SpecimenKey.specimenID value
          - required
      
      - manifest: AssayNanostringMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required

      - manifest: AssayRnaArrayMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required

      - manifest: AssayRnaSeqMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required

      - manifest: AssayScrnaSeqMetadataTemplate
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required

      - manifest: AssayTMTquantitationMetadataTemplate
        level: error
        rules:
          - matchExactlyOne SpecimenKey.specimenID value
          - required
      
      - manifest: assay_wholeGenomeSeq_metadata_template
        level: error
        rules: 
          - matchExactlyOne SpecimenKey.specimenID value
          - required

      - manifest: SpecimenKey
        level: error
        rules: 
          - matchNone SpecimenKey.specimenID value
          - required
          - unique
          - regex match ^[a-zA-Z0-9_.-]+$